<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #map { height: 500px; width: 100%; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/satellite.js"></script>
</head>
<body>
    <h1>Satellite Tracker</h1>
    <select id="satelliteDropdown">
        <option value="">Select a satellite</option>
    </select>
    <button onclick="loadTLEData()">Load TLE Data</button>
    <div id="map"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrl = 'https://celestrak.com/NORAD/elements/gp.php?GROUP=active&FORMAT=json';
            const dropdown = document.getElementById('satelliteDropdown');
            let satelliteData = [];
            let map;
            let satelliteMarker;

            async function loadTLEData() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    const data = await response.json();
                    satelliteData = data;
                    populateSatelliteDropdown(data);
                } catch (error) {
                    console.error('There has been a problem with your fetch operation:', error);
                }
            }

            function populateSatelliteDropdown(data) {
                data.forEach(satellite => {
                    const option = document.createElement('option');
                    option.value = satellite.NORAD_CAT_ID;
                    option.textContent = satellite.OBJECT_NAME;
                    dropdown.appendChild(option);
                });
            }

            dropdown.addEventListener('change', function() {
                const selectedSatelliteId = this.value;
                const selectedSatellite = satelliteData.find(sat => sat.NORAD_CAT_ID === selectedSatelliteId);
                if (selectedSatellite) {
                    updateSatellitePosition(selectedSatellite);
                }
            });

            function updateSatellitePosition(satellite) {
                const tleLine1 = satellite.TLE_LINE1;
                const tleLine2 = satellite.TLE_LINE2;
                const satrec = satellite.twoline2satrec(tleLine1, tleLine2);
                const positionAndVelocity = satellite.propagate(satrec, new Date());
                const positionEci = positionAndVelocity.position;
                const gmst = satellite.gstime(new Date());
                const positionGd = satellite.eciToGeodetic(positionEci, gmst);
                const longitude = satellite.degreesLong(positionGd.longitude);
                const latitude = satellite.degreesLat(positionGd.latitude);

                if (satelliteMarker) {
                    map.removeLayer(satelliteMarker);
                }
                satelliteMarker = L.marker([latitude, longitude]).addTo(map);
                map.setView([latitude, longitude], 4);
            }

            function initializeMap() {
                map = L.map('map').setView([51.505, -0.09], 2);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
            }

            // Load TLE data initially
            loadTLEData();
            initializeMap();
        });
    </script>
</body>
</html>
